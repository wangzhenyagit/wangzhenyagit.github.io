---
layout: post
title: k8s（一）
category: 杂七杂八
tags: k8s
keywords: k8s
---
## 概述

总结两点k8s的与众不同的设计，POD的设计与声明式的理念。

- POD中不仅仅是一个容器，可以是一组相关的容器，POD是调度的最小单位。而且这组容器中可以共享相同的网络与volume，这样设计可以让应用与非功能性的功能解耦，例如日志的收集，可以单独配置相应的收集容器；而且可能在一些场景下需要缓存系统如redis，在一些场景下不需要缓存，可以通过这种方式来现实，而不是从开始就把应用与缓存绑定到一起；此外很多的功能都是通过这种方式来非入侵式地增加功能，如k8s的demonset
- 第二就是k8s的声明式的模型（Declarative model），从本质上，可以把k8s看成一个数据库，所有的通过kuberctl客户端都是通过rest api方式操作数据库，很多controller也是观察数据库进行后续操作。k8s尽可能地保持到所期望的状态：
> Provide the "desired state" and Kubernetes will make it happen

至于什么是k8s，参考官网的一个描述：
> Kubernetes is a portable, extensible open-source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation.

k8s不仅仅是对容器进行编排，而且对于services也会进行管理。

## 架构
![](https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Kubernetes.png/600px-Kubernetes.png)

上图是wiki中的一个架构图，图中能表明一下几点：

- 与Hbase、HDFS一样，是有专门的master节点的。但是这个master与Hbase或其他的不一样，并不是给最终的用户用的，而是给开发或运维人员使用
- k8s有自己的数据库
- 使用软件定义的网络，会与以前的传统的网络在使用上有很多不同

## 典型运行时
![](https://raw.githubusercontent.com/wangzhenyagit/markdown-pic/master/k8s%E6%9E%B6%E6%9E%84%E5%9B%BE.png)

> 1. User via "kubectl" deploys a new application
> 2. API server receives the request and
> stores it in the DB (etcd)
> 3. Watchers/controllers detect the resource
> changes and act upon it
> 4. ReplicaSet watcher/controller detects the
> new app and creates new pods to match
> the desired # of instances
> 5. Scheduler assigns new pods to a kubelet
> 6. Kubelet detects pods and deploys them
> via the container runing (e.g. Docker)
> 7. Kubeproxy manages network traffic
> for the pods – including service discovery
> and load-balancing


参考的IBM开放课程中的一个架构图。也通过7个步骤简要概括了k8s的一个典型的运行，主要过程体现了k8s的声明式模型。

## 核心概念
k8s中的概念很多，功能也很多，对主要的概念进行分析下。

### Labels and Selectors

## Q&A
### 使用软件定义网络有什么限制与优势？
### 容器的隔离的特性，对使用有什么限制？

## 参考
[wiki Kubernetes](https://en.wikipedia.org/wiki/Kubernetes)  
[k8s官网](https://kubernetes.io/docs/concepts/)  
[IBM k8s 微讲堂](https://www.ibm.com/developerworks/community/wikis/home?lang=zh#!/wiki/W30b0c771924e_49d2_b3b7_88a2a2bc2e43/page/Kubernetes%E7%B3%BB%E5%88%97)
