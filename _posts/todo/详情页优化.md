## 主题商店
- 主题商店app的后端系统，主题商店app能够实现类似手机换肤的功能，用户通过登陆app，对主题进行浏览、下载、购买、应用，能把手机桌面图标、背景图片、拨号短信等的个性化的配置。
- 项目迭代方式开发，以主题内容为核心，主要流程从三方设计师主题的制作、通过设计师web站上传主题、我们审核人员对主题的审核，满足规范的主题进入线上内容库、运营进行内容管理，通过app内容分发、付费订单，最后给设计师进行分成，一个完整的业务流程。

## 背景
营收转向体验和功能。 核心指标提高覆盖率->业务的主要策略，免费+多品类

## 多品类方案设计上
### 需求
增加品类，主题包中的模块的概念如图标，做成一个单独的品类运营。

### 产品方案
- 新增品类与原有的品类主题、字体是一个层级的概念。有单独完整的流程、上传、审核。但还要与之前的主题有关联，方便设计师进行更新、减少重复审核。
- 优点：生成一个与以前产品不一样的包，优点有各自的产品id，完整的sku。
- 问题：需要额外关联，引入关联关系，对于设计师操作、审核流程、内容分发领域逻辑改动较大，领域逻辑中多了一个关联的概念。

### 方案改进
- 评估方案影响，对原来的领域逻辑影响较大，且原有领域中主题包已经有层级结构（主题包就是一个文件夹的压缩包，里面放的一些小的压缩包，小的压缩包能实现一个完整功能比如图标的替换），尝试把主题包中的模块当作一个sku方式进行管理，有初步方案后和产品沟通可行性
- 方案沟通时候借鉴DDD统一语言方式，一些核心的概念，整包、模块、与产品达成共识。把目前服务端的领域模型与领域逻辑与产品达成一致。
- 最后，典型的用例场景用模块作为sku的方式确定流程，满足单独定价、单独售卖、单独下载、单独下授权。

以上是方案确定过程，主要是研发主导了方案的确定和推进。

## 开发负责购买、应用流程，原有流程
购买：
- 创建订单（主题）
- 支付
应用：
- 下载主题包
- 检查授权
- 下载加密授权文件，应用主题

### 具体方案开发上
1. 模块与整包使用同一个productId，通过增加一个类型来区别不同sku的订单
2. 相应地，订单、下授权增加类型

### 对订单、下授权流程优化
1. 下载授权过程优化，用户数据比较分散不容易加缓存，通过短时间缓存，对后续的请求的大概率的读命中。
2. 增加授权表。（1. 从业务上订单不等于授权  2. 免费后订单增长，mysql可能需要分库，不是必须用Mysql。 3. 有批量读取的场景，Hbase对并发，非全列扫描支持好，分成信息、下单的设备apk版本信息。）
3. 其他业务流程改造：免费主题多后，根据业务流程，对于免费的主题不再进行设备数目检查。
### 检查授权
4. 批量检查的方式，如检查是否有子模块的授权，一次检查整包产品是否已购

## 通过这方式
业务上：后续增加品类非常快，只是改动一些定义与常量的集合
技术上：mysql表后续不用在分表，对于下授权、检查已购p99,有降低（200多到100多）,p75 100到20



