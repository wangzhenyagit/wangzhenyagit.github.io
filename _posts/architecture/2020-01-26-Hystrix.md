---
layout: post
title: Hystrix
category: 软件架构
tags: Hystrix
---

## Hystrix解决什么问题？

## 如何设计的？

## 参数配置
### 线程池参数
线程池默认的线程数目为10，coreSize与maximum都为10，线程keep alive为1分钟，，在以下类中
```
public abstract class HystrixThreadPoolProperties {

    /* defaults */
    static int default_coreSize = 10;            // core size of thread pool
    static int default_maximumSize = 10;         // maximum size of thread pool
    static int default_keepAliveTimeMinutes = 1; // minutes to keep a thread alive
    static int default_maxQueueSize = -1;        // size of queue (this can't be dynamically changed so we use 'queueSizeRejectionThreshold' to artificially limit and reject)
                                                 // -1 turns it off and makes us use SynchronousQueue
    static boolean default_allow_maximum_size_to_diverge_from_core_size = false; //should the maximumSize config value get read and used in configuring the threadPool
                                                                                 //turning this on should be a conscious decision by the user, so we default it to false

    static int default_queueSizeRejectionThreshold = 5; // number of items in queue
    static int default_threadPoolRollingNumberStatisticalWindow = 10000; // milliseconds for rolling number
    static int default_threadPoolRollingNumberStatisticalWindowBuckets = 10; // number of buckets in rolling number (10 1-second buckets)
    ...
}
```
其中
> static int default_maxQueueSize = -1;        // size of queue (this can't be dynamically changed so we use 'queueSizeRejectionThreshold' to artificially limit and reject)
>                                              // -1 turns it off and makes us use SynchronousQueue

如上所说，主要原因是阻塞队列的maxQueue不能“can't be dynamically changed so we use 'queueSizeRejectionThreshold'”，默认情况下使用default_queueSizeRejectionThreshold
来作为队列中的最大数，超过这个数目就会reject。  

default_allow_maximum_size_to_diverge_from_core_size这个配置默认为false，如果想修改线程池的maxmumsize，配置参数的时候需要修改这个参数为true。
